<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Ticket - bOOk Picturr</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(135deg, #141e30, #243b55);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .navbar {
      background: linear-gradient(90deg, #0d6efd, #6610f2);
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    .navbar-brand { font-weight: bold; font-size: 1.4rem; color: #fff !important; }
    .main-container { flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column; text-align:center; padding:20px; }
    .ticket {
      background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2); backdrop-filter: blur(12px);
      border-radius:20px; padding:25px; max-width:520px; width:100%; box-shadow:0 8px 25px rgba(0,0,0,0.6); position:relative; transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .ticket:hover { transform: translateY(-5px); box-shadow: 0 12px 30px rgba(0,0,0,0.7); }
    .ticket::before, .ticket::after { content:""; position:absolute; width:28px; height:28px; background:#141e30; border-radius:50%; top:50%; transform: translateY(-50%); }
    .ticket::before { left:-14px; } .ticket::after { right:-14px; }
    .ticket h3 { color:#ffc107; font-weight:bold; margin-bottom:15px; }
    .ticket p strong { color:#0d6efd; }
    #ticketQR { border:4px solid rgba(255,255,255,0.2); border-radius:12px; padding:8px; background: rgba(0,0,0,0.2); margin-top:10px; }
    #moviePoster { border-radius:12px; max-width:100%; margin-bottom:15px; box-shadow:0 5px 15px rgba(0,0,0,0.5); }
    .btn-custom { border-radius:30px; font-weight:600; padding:0.7rem 2rem; margin:10px; transition:0.3s; }
    .btn-download { background: linear-gradient(45deg,#17a2b8,#138496); border:none; color:#fff; }
    .btn-download:hover { background: linear-gradient(45deg,#138496,#117a8b); transform: scale(1.07); box-shadow: 0 0 15px rgba(23,162,184,0.8); }
    .btn-home { background: linear-gradient(45deg,#6610f2,#520dc2); border:none; color:#fff; }
    .btn-home:hover { background: linear-gradient(45deg,#520dc2,#3d0a91); transform: scale(1.07); box-shadow:0 0 15px rgba(102,16,242,0.8); }
    .thank-you { margin-top:15px; font-size:14px; font-style:italic; color:#ffc107; }

    /* Email Modal */
    .email-modal {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
      display:none; justify-content:center; align-items:center; z-index:1000;
    }
    .email-modal-content {
      background: #141e30; color:#fff; padding:25px 30px; border-radius:12px;
      text-align:center; width:90%; max-width:400px; box-shadow:0 8px 20px rgba(0,0,0,0.7);
    }
    .email-modal-content input {
      border-radius:25px; padding:0.6rem 1rem; width:100%; border:none;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark">
  <div class="container"><a class="navbar-brand" href="index.html">ğŸ¬ bOOk Picturr</a></div>
</nav>

<!-- Main Content -->
<div class="main-container">
  <h2 class="mb-4 text-success">ğŸ‰ Booking Successful!</h2>

  <div id="ticketArea" class="ticket">
    <h3>ğŸŸï¸ Ticket</h3>
    <hr class="border-light" />
    <img id="moviePoster" src="" alt="Movie Poster" class="img-fluid" />
    <p><strong>ğŸ¬ Movie:</strong> <span id="movie"></span></p>
    <p><strong>ğŸ¢ Theatre:</strong> <span id="theatre"></span></p>
    <p><strong>ğŸ’º Seats:</strong> <span id="seats"></span></p>
    <p><strong>ğŸ“… Date:</strong> <span id="date"></span></p>
    <p><strong>â° Showtime:</strong> <span id="time"></span></p>
    <p><strong>ğŸ’° Amount Paid:</strong> â‚¹<span id="amount"></span></p>
    <hr class="border-light" />
    <img id="ticketQR" src="" alt="Ticket QR" class="img-fluid shadow" width="200" height="200" />
    <p class="text-light mt-2">Show this QR at theatre entrance âœ…</p>
    <div class="thank-you">ğŸ™ Thank you for booking with <b>bOOk Picturr</b>. Enjoy your show! ğŸ¿</div>
  </div>

  <!-- Buttons -->
  <div class="mt-3 text-center">
    <button id="sendEmailBtn" class="btn btn-custom btn-home mt-2">ğŸ“§ Send Email</button>
    <a href="index.html" class="btn btn-custom btn-home mt-2">ğŸ  Back to Home</a>
  </div>
</div>

<!-- Email Modal -->
<div id="emailModal" class="email-modal">
  <div class="email-modal-content">
    <h4>ğŸ“§ Enter Your Email</h4>
    <input type="email" id="modalEmail" placeholder="Enter your email" class="mt-2" />
    <div class="mt-3">
      <button id="modalSendBtn" class="btn btn-custom btn-home">Send Email</button>
      <button id="modalCancelBtn" class="btn btn-custom btn-download">Cancel</button>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
emailjs.init("9sTIa1QgxqfcPR6e-"); // Public Key

// Ticket Data
const movie   = localStorage.getItem("movieName") || "N/A";
const theatre = localStorage.getItem("theatre") || "N/A";
const date    = localStorage.getItem("date") || "N/A";
const time    = localStorage.getItem("time") || "N/A";
const seats   = localStorage.getItem("seats") || "N/A";
const amount  = localStorage.getItem("totalPrice") || "0";
const movieImage = localStorage.getItem("movieImage") || "https://via.placeholder.com/400x200";

document.getElementById("movie").innerText = movie;
document.getElementById("theatre").innerText = theatre;
document.getElementById("date").innerText = date;
document.getElementById("time").innerText = time;
document.getElementById("seats").innerText = seats;
document.getElementById("amount").innerText = amount;
document.getElementById("moviePoster").src = movieImage;

const ticketData = `Movie: ${movie}\nTheatre: ${theatre}\nDate: ${date}\nTime: ${time}\nSeats: ${seats}\nAmount: â‚¹${amount}`;
const qrImg = document.getElementById("ticketQR");
qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(ticketData)}`;

// Modal Logic
const emailModal = document.getElementById("emailModal");
const sendBtn = document.getElementById("sendEmailBtn");
const cancelBtn = document.getElementById("modalCancelBtn");
const modalSendBtn = document.getElementById("modalSendBtn");

sendBtn.addEventListener("click", () => emailModal.style.display = "flex");
cancelBtn.addEventListener("click", () => emailModal.style.display = "none");

modalSendBtn.addEventListener("click", () => {
  const email = document.getElementById("modalEmail").value.trim();
  if(!email) return alert("Please enter a valid email!");

  const bookingId = Date.now();
  const templateParams = {
    to_email: email,
    movie: movie,
    theatre: theatre,
    date: date,
    time: time,
    seats: seats,
    price: amount,
    movie_image: movieImage,
    qr_code: qrImg.src,
    booking_id: bookingId
  };

  emailjs.send("service_hb0i6a9", "template_8w5oiwp", templateParams)
    .then(res => {
      confetti({ particleCount:150, spread:70, origin:{y:0.6} });
      alert("ğŸ‰ Ticket sent successfully!");
      document.getElementById("modalEmail").value = "";
      emailModal.style.display = "none";
    })
    .catch(err => {
      console.error("Email send failed:", err);
      alert("âŒ Failed to send email. Please try again.");
    });
});

</script>
</body>
</html>
